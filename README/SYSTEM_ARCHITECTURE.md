# 访客管理系统架构图

## 🏗️ 系统整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        访客管理系统架构                           │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端层         │    │   后端层         │    │   数据层         │
│                 │    │                 │    │                 │
│  ┌─────────────┐ │    │  ┌─────────────┐ │    │  ┌─────────────┐ │
│  │   React     │ │    │  │   NestJS    │ │    │  │ PostgreSQL  │ │
│  │  TypeScript │ │◄──►│  │  TypeScript │ │◄──►│  │   主数据库   │ │
│  │   Vite      │ │    │  │   Prisma    │ │    │  │             │ │
│  │ Ant Design  │ │    │  │    JWT      │ │    │  └─────────────┘ │
│  └─────────────┘ │    │  └─────────────┘ │    │                 │
│                 │    │                 │    │  ┌─────────────┐ │
│  ┌─────────────┐ │    │  ┌─────────────┐ │    │  │   Redis     │ │
│  │   Router    │ │    │  │   Swagger   │ │    │  │   缓存层    │ │
│  │   Context   │ │    │  │  Validation │ │    │  │   会话存储   │ │
│  │   Hooks     │ │    │  │   Guards    │ │    │  └─────────────┘ │
│  └─────────────┘ │    │  └─────────────┘ │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🎯 业务模块架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        业务模块架构                              │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  用户认证    │    │  访客管理    │    │  物品管理    │    │  系统配置    │
│             │    │             │    │             │    │             │
│ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │
│ │ 登录/登出│ │    │ │ 访客登记│ │    │ │ 物品分类│ │    │ │ 参数配置│ │
│ │ 权限控制│ │    │ │ 入场/离场│ │    │ │ 借用/归还│ │    │ │ 加密存储│ │
│ │ 会话管理│ │    │ │ 状态跟踪│ │    │ │ 状态管理│ │    │ │ 历史记录│ │
│ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  工人管理    │    │  分包商管理  │    │  保安管理    │    │  报表统计    │
│             │    │             │    │             │    │             │
│ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │
│ │ 批量导入│ │    │ │ 分包商信息│ │    │ │ 保安信息│ │    │ │ 数据统计│ │
│ │ 自注册  │ │    │ │ 工地关联│ │    │ │ 权限分配│ │    │ │ 图表展示│ │
│ │ 信息维护│ │    │ │ 工人管理│ │    │ │ 操作记录│ │    │ │ 导出功能│ │
│ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 🔄 数据流架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        数据流架构                                │
└─────────────────────────────────────────────────────────────────┘

用户请求 ──► 前端路由 ──► API调用 ──► 后端控制器 ──► 业务服务 ──► 数据访问层
    ▲                                                              │
    │                                                              ▼
    └─── 响应数据 ◄─── 前端渲染 ◄─── JSON响应 ◄─── 业务逻辑 ◄─── 数据库/缓存
```

## 🛡️ 安全架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        安全架构                                  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  前端安全    │    │  后端安全    │    │  数据安全    │    │  网络安全    │
│             │    │             │    │             │    │             │
│ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │    │ ┌─────────┐ │
│ │ XSS防护 │ │    │ │ JWT认证 │ │    │ │ 密码加密│ │    │ │ HTTPS   │ │
│ │ CSRF防护│ │    │ │ 权限控制│ │    │ │ 数据加密│ │    │ │ CORS    │ │
│ │ 输入验证│ │    │ │ 频率限制│ │    │ │ 备份恢复│ │    │ │ 防火墙  │ │
│ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │    │ └─────────┘ │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

## 🚀 部署架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        部署架构                                  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Docker容器     │    │   负载均衡       │    │   监控日志       │
│                 │    │                 │    │                 │
│ ┌─────────────┐ │    │ ┌─────────────┐ │    │ ┌─────────────┐ │
│ │ 前端容器     │ │    │ │ Nginx       │ │    │ │ 应用监控     │ │
│ │ 后端容器     │ │◄──►│ │ 反向代理     │ │    │ │ 错误日志     │ │
│ │ 数据库容器   │ │    │ │ 静态文件     │ │    │ │ 性能监控     │ │
│ │ 缓存容器     │ │    │ │ SSL终端     │ │    │ │ 业务指标     │ │
│ └─────────────┘ │    │ └─────────────┘ │    │ └─────────────┘ │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📊 技术栈详细架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        技术栈架构                                │
└─────────────────────────────────────────────────────────────────┘

前端技术栈:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   React 18  │ │ TypeScript  │ │    Vite     │ │ Ant Design  │
│   UI框架    │ │  类型安全    │ │  构建工具    │ │  UI组件库   │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

后端技术栈:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   NestJS    │ │   Prisma    │ │     JWT     │ │   Swagger   │
│  Node.js框架│ │    ORM      │ │   认证      │ │  API文档    │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

数据存储:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ PostgreSQL  │ │    Redis    │ │  文件存储    │ │   备份      │
│   主数据库   │ │   缓存层    │ │   上传文件   │ │   恢复      │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

部署运维:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   Docker    │ │ Docker Compose│ │   Nginx    │ │   监控      │
│   容器化    │ │   编排      │ │   代理      │ │   日志      │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

## 🔧 开发工具链

```
┌─────────────────────────────────────────────────────────────────┐
│                        开发工具链                                │
└─────────────────────────────────────────────────────────────────┘

开发环境:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   VS Code   │ │   ESLint    │ │  Prettier   │ │   Git       │
│   编辑器    │ │  代码检查    │ │  代码格式化  │ │   版本控制   │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

测试工具:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│    Jest     │ │   E2E测试   │ │   覆盖率     │ │   调试      │
│   单元测试   │ │   端到端    │ │   统计      │ │   工具      │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

构建部署:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│    Vite     │ │   Docker    │ │   CI/CD     │ │   监控      │
│   构建      │ │   打包      │ │   自动化    │ │   运维      │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

## 📈 性能优化策略

```
┌─────────────────────────────────────────────────────────────────┐
│                        性能优化策略                              │
└─────────────────────────────────────────────────────────────────┘

前端优化:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   代码分割   │ │   懒加载    │ │   缓存策略   │ │   压缩优化   │
│   按需加载   │ │   组件延迟  │ │   API缓存   │ │   资源压缩   │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

后端优化:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   Redis缓存  │ │   连接池    │ │   分页查询   │ │   索引优化   │
│   数据缓存   │ │   连接复用  │ │   大数据集   │ │   查询优化   │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘

数据库优化:
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   索引设计   │ │   查询优化   │ │   分库分表   │ │   读写分离   │
│   性能提升   │ │   SQL优化   │ │   水平扩展   │ │   负载分散   │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

这个架构图展示了访客管理系统的完整技术架构，包括前端、后端、数据层、安全、部署等各个方面的设计。系统采用了现代化的技术栈和最佳实践，具有良好的可扩展性、可维护性和性能表现。
